# IDR_comparison_pipeline

This script generates self-pseudo replicates and pooled-pseudo replicates for a ChIP-seq
experiment. It then run MACS2 (Zhang et al 2008) to call ChIP peaks on the true replicates,
pooled replicates, self-pseudo replicates, and pooled-pseudo replicates.
Next, IDR (Li et al 2011) is run on all pairs of true replicates, self-pseudoreplicates,
ad pooled pseudo replicates. The results file gives the number of peaks
that pass IDR for each pairwise comparison. Using the maximum number of
peaks that pass IDR given two true replicates, a conservative set of peaks
is output from the pooled MACS2 results.

This pipeline is based on the ENCODE paper (Landt et al 2012)

## Dependencies:

* python 2.7
* python libraries:
 * pandas (0.19.2)
 * numpy (1.12.0)
* bedtools
* IDR (https://github.com/nboley/idr)
* MACS2 (https://github.com/taoliu/MACS)
* samtools

## Output Directories

Each output directory is given the format ${prefix}_${dirName). 
There are five possible directories that are output:
* trueReplicates
* truePooled
* pooledPseudoreps 
* selfPseudoReps
* idr_final

Each directory contains MACS2 output and the pooledPseudoreps, trueReplicates, and truePooled
directories all contain output from IDR pairwise comparsions. The IDR output has the 
suffix `-overlapped-peaks.txt` and the IDR plots have the suffix `-overlapped-peaks.txt.png`

### trueReplicates

This directory contains the MACS2 and IDR analyis of the individual true replicates.

### truePooled

This directory contains the MACS2 analyis of the true replicates after pooling them together.

`FDChIP_wiDups_truePooled/poolSamples.bam` is merged bam file that contains all of the replicates
concatonated together.

### pooledPseudoreps

This directory contains the MACS2 and IDR analyis of the pooled-pseudo replicates. 

Pooled-pseudo replicates are generated by randomizing the mapped reads of all of the pooled 
replicates and then dividing the reads in half into two different files. The BAM files for 
the pooled-pseudo replicates will be called `poolSamples.pr1.tagAlign.bam` and 
`poolSamples.pr2.tagAlign.bam`.

### selfPseudoReps

This directory contains the MACS2 and IDR analyis of the self-pseudo replicates.

Self-pseudo replicates are generated by randomizing the mapped reads of the true replicates 
and then dividing the reads in half into two different files. The BAM files for the self-pseudo 
replicates will then have the sufficies `pr1.tagAlign.bam` and`pr2.tagAlign.bam`. For example,
GENE_R1.pr1.tagAlign.bam and GENE_R1.pr2.tagAlign.bam will be the names of the self-pseudo 
replicates for the treatment replicate with the treatment name (t_name) GENE_R1.

MACS2 output from the self-pseudo replicates is also output in this directory.

### idr_final
This directory is output if `--filter_using_idr` is set. This contains the results of 
filtering the pooled peaks using IDR.


## Citations:
* Landt, S. G., Marinov, G. K., Kundaje, A., Kheradpour, P., Pauli, F., Batzoglou, S., ... & Chen, Y. (2012). ChIP-seq guidelines and practices of the ENCODE and modENCODE consortia. Genome research, 22(9), 1813-1831.
* Li, Q., Brown, J. B., Huang, H., & Bickel, P. J. (2011). Measuring reproducibility of high-throughput experiments. The annals of applied statistics, 5(3), 1752-1779.
* Zhang, Y., Liu, T., Meyer, C. A., Eeckhoute, J., Johnson, D. S., Bernstein, B. E., ... & Liu, X. S. (2008). Model-based analysis of ChIP-Seq (MACS). Genome biology, 9(9), R137.
